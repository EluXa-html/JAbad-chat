<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JAbad-chat | –ñ–∞–ª–∞–ª–∞–±–∞–¥ –ö–æ–ª–ª–µ–¥–∂</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .status-creator { background: linear-gradient(45deg, #f59e0b, #dc2626); color: white; }
        .status-admin { background: linear-gradient(45deg, #3b82f6, #1d4ed8); color: white; }
        .status-vip { background: linear-gradient(45deg, #8b5cf6, #7c3aed); color: white; }
        .status-user { background: #6b7280; color: white; }
        
        .message-bubble { max-width: 70%; border-radius: 18px; padding: 12px 16px; }
        .message-bubble.sent { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; margin-left: auto; }
        .message-bubble.received { background: #f3f4f6; color: #374151; margin-right: auto; }
        
        .online-dot { width: 10px; height: 10px; background: #10b981; border-radius: 50%; position: absolute; bottom: 0; right: 0; border: 2px solid white; }
        
        /* Avatar upload */
        .avatar-container {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto;
            cursor: pointer;
        }
        .avatar-img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #3b82f6;
        }
        .avatar-upload-btn {
            position: absolute;
            bottom: 0;
            right: 0;
            background: #3b82f6;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid white;
        }
        .avatar-upload-input { display: none; }
        
        /* Saved logins */
        .saved-login {
            cursor: pointer;
            transition: all 0.2s;
        }
        .saved-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app" class="min-h-screen"></div>

    <script>
        // JAbad-chat App
        class JAbadChat {
            constructor() {
                this.state = {
                    page: 'login',
                    user: null,
                    messages: [],
                    users: [],
                    newMessage: '',
                    
                    // Login/Register
                    regUsername: '',
                    regLogin: '',
                    regPassword: '',
                    
                    // Profile
                    editingProfile: false,
                    editUsername: '',
                    editCustomStatus: '',
                    avatarPreview: null,
                    
                    // Admin
                    selectedUserForStatus: null,
                    newStatus: 'user',
                    newCustomStatus: '',
                    
                    // Moderation
                    tempBlocks: {},
                    
                    // Saved logins
                    savedLogins: []
                };
                
                this.init();
            }
            
            init() {
                // Load all data from localStorage
                this.loadFromStorage();
                
                // Check temp blocks
                this.checkTempBlocks();
                
                // Create default users if empty
                if (!this.state.users || this.state.users.length === 0) {
                    this.createDefaultUsers();
                }
                
                // Load saved logins
                this.loadSavedLogins();
                
                this.render();
            }
            
            loadFromStorage() {
                try {
                    const savedUser = localStorage.getItem('jabad_user');
                    const savedMessages = localStorage.getItem('jabad_messages');
                    const savedUsers = localStorage.getItem('jabad_users');
                    const savedBlocks = localStorage.getItem('jabad_tempblocks');
                    const savedLogins = localStorage.getItem('jabad_saved_logins');
                    
                    if (savedUser) this.state.user = JSON.parse(savedUser);
                    if (savedMessages) this.state.messages = JSON.parse(savedMessages);
                    if (savedUsers) this.state.users = JSON.parse(savedUsers);
                    if (savedBlocks) this.state.tempBlocks = JSON.parse(savedBlocks);
                    if (savedLogins) this.state.savedLogins = JSON.parse(savedLogins);
                } catch (e) {
                    console.log('Loading error:', e);
                    // If error, start fresh
                    localStorage.clear();
                    this.createDefaultUsers();
                }
            }
            
            loadSavedLogins() {
                // Get unique logins from users who have logged in before
                const savedLogins = [];
                const loginSet = new Set();
                
                this.state.users.forEach(user => {
                    if (user.login && !loginSet.has(user.login)) {
                        loginSet.add(user.login);
                        savedLogins.push({
                            login: user.login,
                            username: user.username,
                            avatar: user.avatar,
                            lastLogin: user.lastLogin || new Date().toISOString()
                        });
                    }
                });
                
                // Sort by last login (most recent first)
                savedLogins.sort((a, b) => new Date(b.lastLogin) - new Date(a.lastLogin));
                this.state.savedLogins = savedLogins.slice(0, 5); // Keep only 5 most recent
            }
            
            saveSavedLogins() {
                localStorage.setItem('jabad_saved_logins', JSON.stringify(this.state.savedLogins));
            }
            
            addToSavedLogins(user) {
                // Remove if already exists
                this.state.savedLogins = this.state.savedLogins.filter(l => l.login !== user.login);
                
                // Add to beginning
                this.state.savedLogins.unshift({
                    login: user.login,
                    username: user.username,
                    avatar: user.avatar,
                    lastLogin: new Date().toISOString()
                });
                
                // Keep only 5 most recent
                this.state.savedLogins = this.state.savedLogins.slice(0, 5);
                this.saveSavedLogins();
            }
            
            checkTempBlocks() {
                const now = Date.now();
                for (const userId in this.state.tempBlocks) {
                    if (this.state.tempBlocks[userId] < now) {
                        delete this.state.tempBlocks[userId];
                    }
                }
                this.saveAll();
            }
            
            saveAll() {
                try {
                    if (this.state.user) {
                        localStorage.setItem('jabad_user', JSON.stringify(this.state.user));
                    }
                    localStorage.setItem('jabad_messages', JSON.stringify(this.state.messages));
                    localStorage.setItem('jabad_users', JSON.stringify(this.state.users));
                    localStorage.setItem('jabad_tempblocks', JSON.stringify(this.state.tempBlocks));
                } catch (e) {
                    console.log('Save error:', e);
                }
            }
            
            createDefaultUsers() {
                this.state.users = [
                    {
                        id: '1',
                        username: 'exm_404',
                        login: 'exm_404',
                        password: 'eluxa',
                        avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=exm404',
                        status: 'creator',
                        customStatus: '–ü—Ä–æ–µ–∫—Ç—Ç–∏–Ω –°–æ–∑–¥–∞—Ç–µ–ª–∏',
                        role: 'superadmin',
                        vipLevel: 10,
                        isOnline: true,
                        isBlocked: false,
                        registeredAt: new Date().toISOString(),
                        bio: 'JAbad-chat —Å–∏—Å—Ç–µ–º–∞—Å—ã–Ω—ã–Ω –Ω–µ–≥–∏–∑–¥”©”©—á“Ø—Å“Ø',
                        lastLogin: new Date().toISOString()
                    },
                    {
                        id: '2',
                        username: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
                        login: 'admin',
                        password: 'admin123',
                        avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=admin',
                        status: 'admin',
                        customStatus: '–°–∏—Å—Ç–µ–º–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã',
                        role: 'admin',
                        vipLevel: 5,
                        isOnline: true,
                        isBlocked: false,
                        registeredAt: new Date().toISOString(),
                        bio: '–°–∏—Å—Ç–µ–º–∞–Ω—ã–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã',
                        lastLogin: new Date().toISOString()
                    },
                    {
                        id: '3',
                        username: 'VIP –°—Ç—É–¥–µ–Ω—Ç',
                        login: 'vip',
                        password: 'vip123',
                        avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=vip',
                        status: 'vip',
                        customStatus: '–ê–∫—Ç–∏–≤–¥“Ø“Ø —Å—Ç—É–¥–µ–Ω—Ç',
                        role: 'user',
                        vipLevel: 2,
                        isOnline: true,
                        isBlocked: false,
                        registeredAt: new Date().toISOString(),
                        bio: '–ñ–∞–ª–∞–ª–∞–±–∞–¥ –∫–æ–ª–ª–µ–¥–∂–∏–Ω–∏–Ω —Å—Ç—É–¥–µ–Ω—Ç–∏',
                        lastLogin: new Date().toISOString()
                    }
                ];
                this.saveAll();
            }
            
            uploadAvatar(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                if (file.size > 2 * 1024 * 1024) {
                    alert('–§–∞–π–ª–¥—ã–Ω –∫”©–ª”©–º“Ø 2MB–¥–∞–Ω —á–æ“£ –±–æ–ª–±–æ—à—É –∫–µ—Ä–µ–∫!');
                    return;
                }
                
                if (!file.type.match('image.*')) {
                    alert('–°“Ø—Ä”©—Ç —Ñ–∞–π–ª—ã –≥–∞–Ω–∞ –∂“Ø–∫—Ç”©”©–≥”© –±–æ–ª–æ—Ç!');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    this.state.user.avatar = e.target.result;
                    this.state.avatarPreview = e.target.result;
                    
                    const userIndex = this.state.users.findIndex(u => u.id === this.state.user.id);
                    if (userIndex !== -1) {
                        this.state.users[userIndex].avatar = e.target.result;
                    }
                    
                    this.saveAll();
                    this.render();
                    alert('–°“Ø—Ä”©—Ç“Ø“£“Ø–∑ –∏–π–≥–∏–ª–∏–∫—Ç“Ø“Ø –∞–ª–º–∞—à—Ç—ã—Ä—ã–ª–¥—ã!');
                };
                reader.readAsDataURL(file);
            }
            
            updateProfile() {
                if (!this.state.editUsername.trim()) {
                    alert('–ê—Ç—ã“£—ã–∑–¥—ã –∂–∞–∑—ã“£—ã–∑!');
                    return;
                }
                
                this.state.user.username = this.state.editUsername;
                this.state.user.customStatus = this.state.editCustomStatus;
                
                const userIndex = this.state.users.findIndex(u => u.id === this.state.user.id);
                if (userIndex !== -1) {
                    this.state.users[userIndex].username = this.state.editUsername;
                    this.state.users[userIndex].customStatus = this.state.editCustomStatus;
                }
                
                this.state.editingProfile = false;
                this.saveAll();
                this.render();
                alert('–ü—Ä–æ—Ñ–∏–ª—å –∏–π–≥–∏–ª–∏–∫—Ç“Ø“Ø –∂–∞“£—ã—Ä—Ç—ã–ª–¥—ã!');
            }
            
            login(login, password) {
                if (!login || !password) {
                    alert('–õ–æ–≥–∏–Ω –∂–∞–Ω–∞ —Å—ã—Ä—Å”©–∑ –∂–∞–∑—ã“£—ã–∑!');
                    return;
                }
                
                const user = this.state.users.find(u => 
                    u.login === login && u.password === password
                );
                
                if (user) {
                    if (user.isBlocked) {
                        alert('–°–∏–∑–¥–∏–Ω –∞–∫–∫–∞—É–Ω—Ç—É“£—É–∑ –±–ª–æ–∫—Ç–æ—Ä—É–ª–≥–∞–Ω!');
                        return;
                    }
                    
                    if (this.state.tempBlocks[user.id]) {
                        alert('–°–∏–∑ —É–±–∞–∫—Ç—ã–ª—É—É –±–ª–æ–∫—Ç–æ—Ä—É–ª–¥—É“£—É–∑!');
                        return;
                    }
                    
                    user.isOnline = true;
                    user.lastLogin = new Date().toISOString();
                    this.state.user = user;
                    this.state.page = 'chat';
                    
                    // Add to saved logins
                    this.addToSavedLogins(user);
                    
                    this.saveAll();
                    this.render();
                } else {
                    alert('–ö–∞—Ç–∞ –ª–æ–≥–∏–Ω –∂–µ —Å—ã—Ä—Å”©–∑!');
                }
            }
            
            quickLogin(login) {
                // Find user and show password input
                const user = this.state.users.find(u => u.login === login);
                if (user) {
                    document.getElementById('loginInput').value = login;
                    document.getElementById('loginPass').focus();
                }
            }
            
            register() {
                if (!this.state.regUsername || !this.state.regLogin || !this.state.regPassword) {
                    alert('–ë–∞–∞—Ä—ã–Ω —Ç–æ–ª—Ç—É—Ä—É“£—ã–∑!');
                    return;
                }
                
                if (this.state.users.some(u => u.login === this.state.regLogin)) {
                    alert('–ë—É–ª –ª–æ–≥–∏–Ω –º—É—Ä—É–Ω—Ç–∞–Ω —ç–ª–µ –±–∞—Ä!');
                    return;
                }
                
                const newUser = {
                    id: Date.now().toString(),
                    username: this.state.regUsername,
                    login: this.state.regLogin,
                    password: this.state.regPassword,
                    avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=${this.state.regLogin}`,
                    status: 'user',
                    customStatus: '',
                    role: 'user',
                    vipLevel: 0,
                    isOnline: true,
                    isBlocked: false,
                    registeredAt: new Date().toISOString(),
                    bio: '–ñ–∞–ª–∞–ª–∞–±–∞–¥ –∫–æ–ª–ª–µ–¥–∂–∏–Ω–∏–Ω –∂–∞“£—ã —Å—Ç—É–¥–µ–Ω—Ç–∏',
                    lastLogin: new Date().toISOString()
                };
                
                this.state.users.push(newUser);
                this.state.user = newUser;
                this.state.page = 'chat';
                
                // Add to saved logins
                this.addToSavedLogins(newUser);
                
                this.state.regUsername = '';
                this.state.regLogin = '';
                this.state.regPassword = '';
                
                this.saveAll();
                this.render();
                
                alert('–ö–∞—Ç—Ç–∞–ª–¥—ã“£—ã–∑! –ö–æ—à –∫–µ–ª–∏“£–∏–∑, ' + newUser.username);
            }
            
            sendMessage() {
                if (!this.state.newMessage.trim()) return;
                
                const message = {
                    id: Date.now().toString(),
                    text: this.state.newMessage,
                    senderId: this.state.user.id,
                    senderName: this.state.user.username,
                    senderAvatar: this.state.user.avatar,
                    senderStatus: this.state.user.status,
                    senderCustomStatus: this.state.user.customStatus,
                    timestamp: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                    date: new Date().toLocaleDateString()
                };
                
                this.state.messages.push(message);
                this.state.newMessage = '';
                this.saveAll();
                this.render();
            }
            
            updateUserStatus(userId, status, customStatus = '') {
                const user = this.state.users.find(u => u.id === userId);
                if (user) {
                    user.status = status;
                    user.customStatus = customStatus;
                    
                    if (status === 'creator') user.role = 'superadmin';
                    else if (status === 'admin') user.role = 'admin';
                    else user.role = 'user';
                    
                    if (this.state.user && this.state.user.id === userId) {
                        this.state.user.status = status;
                        this.state.user.customStatus = customStatus;
                        this.state.user.role = user.role;
                    }
                    
                    this.saveAll();
                    this.render();
                    alert('–°—Ç–∞—Ç—É—Å –∏–π–≥–∏–ª–∏–∫—Ç“Ø“Ø ”©–∑–≥”©—Ä—Ç“Ø–ª–¥“Ø!');
                }
            }
            
            tempBlockUser(userId, minutes = 60) {
                const blockUntil = Date.now() + (minutes * 60000);
                this.state.tempBlocks[userId] = blockUntil;
                
                const user = this.state.users.find(u => u.id === userId);
                if (user) {
                    user.isOnline = false;
                }
                
                this.saveAll();
                this.render();
                
                alert('–ö–æ–ª–¥–æ–Ω—É—É—á—É ' + minutes + ' –º“Ø–Ω”©—Ç–∫”© –±–ª–æ–∫—Ç–æ—Ä—É–ª–¥—É!');
            }
            
            unblockUser(userId) {
                delete this.state.tempBlocks[userId];
                const user = this.state.users.find(u => u.id === userId);
                if (user) {
                    user.isBlocked = false;
                }
                this.saveAll();
                this.render();
            }
            
            getStatusBadge(status, customStatus = '') {
                const statusText = customStatus || 
                    (status === 'creator' ? '–°–æ–∑–¥–∞—Ç–µ–ª—å' :
                     status === 'admin' ? '–ê–¥–º–∏–Ω' :
                     status === 'vip' ? 'VIP' : '–ö–æ–ª–¥–æ–Ω—É—É—á—É');
                
                const statusClass = status === 'creator' ? 'status-creator' :
                                  status === 'admin' ? 'status-admin' :
                                  status === 'vip' ? 'status-vip' : 'status-user';
                
                return `<span class="px-2 py-1 rounded-full text-xs font-medium ${statusClass}">${statusText}</span>`;
            }
            
            logout() {
                if (this.state.user) {
                    const user = this.state.users.find(u => u.id === this.state.user.id);
                    if (user) user.isOnline = false;
                }
                
                this.state.user = null;
                this.state.page = 'login';
                localStorage.removeItem('jabad_user');
                this.saveAll();
                this.render();
            }
            
            render() {
                const app = document.getElementById('app');
                if (!app) return;
                
                try {
                    switch(this.state.page) {
                        case 'login': app.innerHTML = this.renderLogin(); break;
                        case 'register': app.innerHTML = this.renderRegister(); break;
                        case 'chat': app.innerHTML = this.renderChat(); break;
                        case 'profile': app.innerHTML = this.renderProfile(); break;
                        case 'admin': app.innerHTML = this.renderAdmin(); break;
                        case 'editStatus': app.innerHTML = this.renderEditStatus(); break;
                    }
                } catch (error) {
                    console.error('Render error:', error);
                    app.innerHTML = `
                        <div class="flex items-center justify-center h-screen">
                            <div class="text-center p-8 bg-white rounded-lg shadow">
                                <div class="text-red-500 text-4xl mb-4">‚ö†Ô∏è</div>
                                <h1 class="text-xl font-bold text-gray-800 mb-2">–ö–∞—Ç–∞ –∫–µ—Ç—Ç–∏</h1>
                                <button onclick="location.reload()" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                                    –ñ–∞“£—ã–ª–æ–æ
                                </button>
                            </div>
                        </div>
                    `;
                }
            }
            
            renderLogin() {
                return `
                    <div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-purple-50 p-4">
                        <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md">
                            <div class="text-center mb-8">
                                <div class="gradient-bg w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i class="fas fa-mountains text-white text-3xl"></i>
                                </div>
                                <h1 class="text-3xl font-bold text-gray-800">JAbad-chat</h1>
                                <p class="text-gray-600 mt-2">–ñ–∞–ª–∞–ª–∞–±–∞–¥ –ö–æ–ª–ª–µ–¥–∂</p>
                                <p class="text-sm text-gray-500 mt-1">–°–æ–∑–¥–∞—Ç–µ–ª—å: eXM_404</p>
                            </div>
                            
                            <!-- Quick Login Buttons -->
                            ${this.state.savedLogins.length > 0 ? `
                                <div class="mb-6">
                                    <p class="text-sm text-gray-600 mb-3">–°–∞–∫—Ç–∞–ª–≥–∞–Ω –ª–æ–≥–∏–Ω–¥–µ—Ä:</p>
                                    <div class="flex flex-wrap gap-2">
                                        ${this.state.savedLogins.map(login => `
                                            <button onclick="app.quickLogin('${login.login}')"
                                                    class="saved-login flex items-center gap-2 px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg">
                                                <img src="${login.avatar}" class="w-6 h-6 rounded-full">
                                                <span class="text-sm font-medium">${login.username}</span>
                                            </button>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                            
                            <!-- Login Form -->
                            <div class="space-y-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        –õ–æ–≥–∏–Ω
                                    </label>
                                    <input
                                        type="text"
                                        id="loginInput"
                                        class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        placeholder="–í–∞—à –ª–æ–≥–∏–Ω"
                                    />
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        –ü–∞—Ä–æ–ª—å
                                    </label>
                                    <input
                                        type="password"
                                        id="loginPass"
                                        class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        placeholder="–ü–∞—Ä–æ–ª—å—É–Ω—É–∑"
                                    />
                                </div>
                                
                                <button
                                    onclick="app.login(document.getElementById('loginInput').value, document.getElementById('loginPass').value)"
                                    class="gradient-bg w-full text-white font-semibold py-3 px-4 rounded-lg hover:opacity-90"
                                >
                                    –ö–∏—Ä“Ø“Ø
                                </button>
                                
                                <button
                                    onclick="app.state.page='register'; app.render();"
                                    class="w-full border-2 border-gray-300 text-gray-700 font-semibold py-3 px-4 rounded-lg hover:bg-gray-50"
                                >
                                    –ñ–∞“£—ã –∫–∞—Ç—Ç–∞–ª—É—É
                                </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            renderRegister() {
                return `
                    <div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-green-50 to-blue-50 p-4">
                        <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md">
                            <div class="text-center mb-6">
                                <h1 class="text-2xl font-bold text-gray-800">–ñ–∞“£—ã –∫–∞—Ç—Ç–∞–ª—É—É</h1>
                                <p class="text-gray-600">JAbad-chat —Å–∏—Å—Ç–µ–º–∞—Å—ã–Ω–∞ –∫–∞—Ç—Ç–∞–ª—ã“£—ã–∑</p>
                            </div>
                            
                            <div class="space-y-4">
                                <input
                                    type="text"
                                    value="${this.state.regUsername}"
                                    oninput="app.state.regUsername=this.value"
                                    class="w-full border border-gray-300 rounded-lg px-4 py-3"
                                    placeholder="–ê—Ç—ã-–∂”©–Ω“Ø“£“Ø–∑"
                                />
                                
                                <input
                                    type="text"
                                    value="${this.state.regLogin}"
                                    oninput="app.state.regLogin=this.value"
                                    class="w-full border border-gray-300 rounded-lg px-4 py-3"
                                    placeholder="–õ–æ–≥–∏–Ω (–∫–æ–ª–¥–æ–Ω—É—É—á—É –∞—Ç—ã)"
                                />
                                
                                <input
                                    type="password"
                                    value="${this.state.regPassword}"
                                    oninput="app.state.regPassword=this.value"
                                    class="w-full border border-gray-300 rounded-lg px-4 py-3"
                                    placeholder="–ö—É–ø—É—è —Å—ã—Ä—Å”©–∑"
                                />
                                
                                <div class="flex gap-3 pt-2">
                                    <button
                                        onclick="app.register()"
                                        class="flex-1 bg-gradient-to-r from-green-600 to-blue-600 text-white font-semibold py-3 rounded-lg hover:opacity-90"
                                    >
                                        –ö–∞—Ç—Ç–∞–ª—É—É
                                    </button>
                                    
                                    <button
                                        onclick="app.state.page='login'; app.render();"
                                        class="flex-1 border-2 border-gray-300 text-gray-700 font-semibold py-3 rounded-lg hover:bg-gray-50"
                                    >
                                        –ê—Ä—Ç–∫–∞
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            renderChat() {
                const onlineUsers = this.state.users.filter(u => u.isOnline && !this.state.tempBlocks[u.id]);
                const isTempBlocked = this.state.user ? this.state.tempBlocks[this.state.user.id] : false;
                
                return `
                    <div class="flex h-screen bg-gray-100">
                        <!-- Sidebar -->
                        <div class="w-20 bg-white border-r flex flex-col">
                            <div class="p-4">
                                <div class="gradient-bg w-12 h-12 rounded-lg flex items-center justify-center">
                                    <span class="text-white font-bold">JA</span>
                                </div>
                            </div>
                            
                            <div class="flex-1 py-4 space-y-2">
                                <button class="p-3 text-blue-600 bg-blue-50 rounded-lg">
                                    <i class="fas fa-comments"></i>
                                </button>
                                
                                <button onclick="app.state.page='profile'; app.render();"
                                        class="p-3 text-gray-500 hover:bg-gray-100 rounded-lg">
                                    <i class="fas fa-user"></i>
                                </button>
                                
                                ${this.state.user && (this.state.user.role === 'admin' || this.state.user.role === 'superadmin') ? `
                                    <button onclick="app.state.page='admin'; app.render();"
                                            class="p-3 text-gray-500 hover:bg-gray-100 rounded-lg">
                                        <i class="fas fa-shield-alt"></i>
                                    </button>
                                ` : ''}
                            </div>
                            
                            <div class="p-4 border-t">
                                <div class="relative mb-4">
                                    <img src="${this.state.user.avatar}" class="w-10 h-10 rounded-full">
                                    <div class="online-dot"></div>
                                </div>
                                <button onclick="app.logout()" class="w-full p-2 text-gray-500 hover:text-red-600">
                                    <i class="fas fa-sign-out-alt"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Main Chat -->
                        <div class="flex-1 flex flex-col">
                            <!-- Header -->
                            <div class="bg-white border-b p-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h1 class="text-xl font-bold text-gray-800">JAbad –ß–∞—Ç</h1>
                                        <p class="text-sm text-gray-600">
                                            ${onlineUsers.length} –æ–Ω–ª–∞–π–Ω ‚Ä¢ ${this.state.messages.length} –±–∏–ª–¥–∏—Ä“Ø“Ø
                                        </p>
                                    </div>
                                    
                                    <div class="flex items-center gap-3">
                                        <div class="text-right">
                                            <div class="font-medium flex items-center gap-2">
                                                ${this.state.user.username}
                                                ${this.getStatusBadge(this.state.user.status, this.state.user.customStatus)}
                                            </div>
                                            <div class="text-xs text-gray-500">@${this.state.user.login}</div>
                                        </div>
                                        <img src="${this.state.user.avatar}" class="w-10 h-10 rounded-full">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Messages -->
                            <div class="flex-1 overflow-y-auto p-4 space-y-4">
                                ${this.state.messages.map(msg => {
                                    const sender = this.state.users.find(u => u.id === msg.senderId);
                                    return `
                                        <div class="${msg.senderId === this.state.user.id ? 'text-right' : 'text-left'}">
                                            <div class="inline-block max-w-xs lg:max-w-md">
                                                <div class="flex items-center gap-2 mb-1 ${msg.senderId === this.state.user.id ? 'justify-end' : 'justify-start'}">
                                                    ${msg.senderId !== this.state.user.id ? `
                                                        <img src="${sender?.avatar || msg.senderAvatar}" class="w-6 h-6 rounded-full">
                                                    ` : ''}
                                                    <span class="font-medium">${msg.senderId === this.state.user.id ? '–°–∏–∑' : msg.senderName}</span>
                                                    ${this.getStatusBadge(msg.senderStatus || 'user', msg.senderCustomStatus)}
                                                    <span class="text-xs text-gray-500">${msg.timestamp}</span>
                                                </div>
                                                <div class="message-bubble ${msg.senderId === this.state.user.id ? 'sent' : 'received'}">
                                                    ${msg.text}
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                            
                            <!-- Message Input -->
                            <div class="border-t bg-white p-4">
                                ${isTempBlocked ? `
                                    <div class="text-center text-red-600 p-4">
                                        üö´ –°–∏–∑ —É–±–∞–∫—Ç—ã–ª—É—É –±–ª–æ–∫—Ç–æ—Ä—É–ª–¥—É“£—É–∑!
                                    </div>
                                ` : `
                                    <div class="flex gap-2">
                                        <input
                                            type="text"
                                            value="${this.state.newMessage}"
                                            oninput="app.state.newMessage=this.value"
                                            onkeypress="if(event.key==='Enter') app.sendMessage()"
                                            class="flex-1 border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="–ë–∏–ª–¥–∏—Ä“Ø“Ø –∂–∞–∑—ã“£—ã–∑..."
                                        />
                                        <button
                                            onclick="app.sendMessage()"
                                            class="gradient-bg text-white px-6 py-3 rounded-lg hover:opacity-90"
                                        >
                                            <i class="fas fa-paper-plane"></i>
                                        </button>
                                    </div>
                                `}
                            </div>
                        </div>
                        
                        <!-- Online Users -->
                        <div class="hidden lg:block w-64 border-l bg-white p-4">
                            <h3 class="font-semibold text-gray-700 mb-4">
                                <i class="fas fa-users mr-2"></i>
                                –û–Ω–ª–∞–π–Ω –∫–æ–ª–¥–æ–Ω—É—É—á—É–ª–∞—Ä
                            </h3>
                            <div class="space-y-3">
                                ${this.state.users.map(user => `
                                    <div class="flex items-center justify-between p-2 hover:bg-gray-50 rounded">
                                        <div class="flex items-center gap-3">
                                            <div class="relative">
                                                <img src="${user.avatar}" class="w-8 h-8 rounded-full">
                                                ${user.isOnline && !this.state.tempBlocks[user.id] ? '<div class="online-dot"></div>' : ''}
                                            </div>
                                            <div>
                                                <div class="font-medium">${user.username}</div>
                                                <div class="text-xs text-gray-500">@${user.login}</div>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            ${this.getStatusBadge(user.status, user.customStatus)}
                                            ${this.state.tempBlocks[user.id] ? '<span class="text-xs text-red-600">üö´</span>' : ''}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            renderProfile() {
                if (!this.state.editUsername) {
                    this.state.editUsername = this.state.user.username;
                }
                if (!this.state.editCustomStatus) {
                    this.state.editCustomStatus = this.state.user.customStatus || '';
                }
                
                return `
                    <div class="min-h-screen flex items-center justify-center bg-gray-50 p-4">
                        <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md">
                            <div class="text-center mb-6">
                                <h1 class="text-2xl font-bold text-gray-800">–ü—Ä–æ—Ñ–∏–ª—å</h1>
                                <p class="text-gray-600">JAbad-chat —Å–∏—Å—Ç–µ–º–∞—Å—ã</p>
                            </div>
                            
                            ${this.state.editingProfile ? this.renderEditProfile() : this.renderViewProfile()}
                        </div>
                    </div>
                `;
            }
            
            renderViewProfile() {
                return `
                    <div class="space-y-6">
                        <!-- Avatar -->
                        <div class="avatar-container">
                            <img src="${this.state.user.avatar}" class="avatar-img" id="avatarPreview">
                            <label class="avatar-upload-btn" for="avatarUpload">
                                <i class="fas fa-camera"></i>
                            </label>
                            <input type="file" id="avatarUpload" class="avatar-upload-input" 
                                   accept="image/*" onchange="app.uploadAvatar(event)">
                        </div>
                        
                        <!-- User Info -->
                        <div class="space-y-4">
                            <div class="text-center">
                                <h2 class="text-xl font-bold text-gray-800">${this.state.user.username}</h2>
                                <div class="mt-2">
                                    ${this.getStatusBadge(this.state.user.status, this.state.user.customStatus)}
                                </div>
                                <p class="text-gray-600 mt-2">@${this.state.user.login}</p>
                            </div>
                            
                            <div class="space-y-2">
                                <div class="flex justify-between p-2 bg-gray-50 rounded">
                                    <span class="text-gray-600">–†–æ–ª:</span>
                                    <span class="font-medium">${this.state.user.role === 'superadmin' ? '–°–æ–∑–¥–∞—Ç–µ–ª—å' : 
                                                              this.state.user.role === 'admin' ? '–ê–¥–º–∏–Ω' : '–ö–æ–ª–¥–æ–Ω—É—É—á—É'}</span>
                                </div>
                                
                                <div class="flex justify-between p-2 bg-gray-50 rounded">
                                    <span class="text-gray-600">VIP:</span>
                                    <span class="font-medium">${this.state.user.vipLevel}</span>
                                </div>
                                
                                <div class="flex justify-between p-2 bg-gray-50 rounded">
                                    <span class="text-gray-600">–ö–∞—Ç—Ç–∞–ª–≥–∞–Ω:</span>
                                    <span class="font-medium">${new Date(this.state.user.registeredAt).toLocaleDateString()}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Actions -->
                        <div class="flex gap-3 pt-4">
                            <button
                                onclick="app.state.editingProfile=true; app.render();"
                                class="flex-1 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold py-3 rounded-lg hover:opacity-90"
                            >
                                ”®–∑–≥”©—Ä—Ç“Ø“Ø
                            </button>
                            
                            <button
                                onclick="app.state.page='chat'; app.render();"
                                class="flex-1 border-2 border-gray-300 text-gray-700 font-semibold py-3 rounded-lg hover:bg-gray-50"
                            >
                                –ê—Ä—Ç–∫–∞
                            </button>
                        </div>
                    </div>
                `;
            }
            
            renderEditProfile() {
                return `
                    <div class="space-y-6">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    –ê—Ç—ã-–∂”©–Ω“Ø“£“Ø–∑
                                </label>
                                <input
                                    type="text"
                                    value="${this.state.editUsername}"
                                    oninput="app.state.editUsername=this.value"
                                    class="w-full border border-gray-300 rounded-lg px-4 py-3"
                                    placeholder="–ê—Ç—ã“£—ã–∑"
                                />
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    ”®–∑–≥”©—á”© —Å—Ç–∞—Ç—É—Å
                                </label>
                                <input
                                    type="text"
                                    value="${this.state.editCustomStatus}"
                                    oninput="app.state.editCustomStatus=this.value"
                                    class="w-full border border-gray-300 rounded-lg px-4 py-3"
                                    placeholder="–ú–∏—Å–∞–ª—ã: –ê–∫—Ç–∏–≤–¥“Ø“Ø —Å—Ç—É–¥–µ–Ω—Ç"
                                />
                            </div>
                        </div>
                        
                        <div class="flex gap-3 pt-4">
                            <button
                                onclick="app.updateProfile()"
                                class="flex-1 bg-gradient-to-r from-green-600 to-blue-600 text-white font-semibold py-3 rounded-lg hover:opacity-90"
                            >
                                –°–∞–∫—Ç–æ–æ
                            </button>
                            
                            <button
                                onclick="app.state.editingProfile=false; app.render();"
                                class="flex-1 border-2 border-gray-300 text-gray-700 font-semibold py-3 rounded-lg hover:bg-gray-50"
                            >
                                –ñ–æ–∫–∫–æ —á—ã–≥–∞—Ä—É—É
                            </button>
                        </div>
                    </div>
                `;
            }
            
            renderAdmin() {
                const onlineUsers = this.state.users.filter(u => u.isOnline && !this.state.tempBlocks[u.id]);
                const tempBlockedUsers = this.state.users.filter(u => this.state.tempBlocks[u.id]);
                
                return `
                    <div class="flex h-screen bg-gray-100">
                        <!-- Sidebar -->
                        <div class="w-20 bg-white border-r flex flex-col">
                            <div class="p-4">
                                <div class="bg-red-600 w-12 h-12 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-shield-alt text-white text-xl"></i>
                                </div>
                            </div>
                            
                            <div class="flex-1 py-4 space-y-2">
                                <button onclick="app.state.page='chat'; app.render();"
                                        class="w-full p-3 text-gray-500 hover:bg-gray-100">
                                    <i class="fas fa-arrow-left"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Admin Panel -->
                        <div class="flex-1 p-6 overflow-y-auto">
                            <div class="mb-8">
                                <h1 class="text-2xl font-bold text-gray-800">–ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª–∏</h1>
                                <p class="text-gray-600 mt-2">JAbad-chat –±–∞—à–∫–∞—Ä—É—É —Å–∏—Å—Ç–µ–º–∞—Å—ã</p>
                            </div>
                            
                            <!-- Stats -->
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                                <div class="bg-white p-4 rounded-xl border">
                                    <div class="text-gray-500 text-sm">–û–Ω–ª–∞–π–Ω</div>
                                    <div class="text-2xl font-bold mt-1">${onlineUsers.length}</div>
                                </div>
                                
                                <div class="bg-white p-4 rounded-xl border">
                                    <div class="text-gray-500 text-sm">–ë–ª–æ–∫—Ç–æ—Ä—É–ª–≥–∞–Ω</div>
                                    <div class="text-2xl font-bold mt-1 text-red-600">${tempBlockedUsers.length}</div>
                                </div>
                                
                                <div class="bg-white p-4 rounded-xl border">
                                    <div class="text-gray-500 text-sm">–ë–∏–ª–¥–∏—Ä“Ø“Ø–ª”©—Ä</div>
                                    <div class="text-2xl font-bold mt-1">${this.state.messages.length}</div>
                                </div>
                                
                                <div class="bg-white p-4 rounded-xl border">
                                    <div class="text-gray-500 text-sm">–ö–æ–ª–¥–æ–Ω—É—É—á—É–ª–∞—Ä</div>
                                    <div class="text-2xl font-bold mt-1">${this.state.users.length}</div>
                                </div>
                            </div>
                            
                            <!-- User Management -->
                            <div class="bg-white rounded-xl border mb-8">
                                <div class="p-4 border-b">
                                    <h2 class="text-lg font-semibold text-gray-800">–ö–æ–ª–¥–æ–Ω—É—É—á—É–ª–∞—Ä</h2>
                                </div>
                                
                                <div class="p-4 space-y-3">
                                    ${this.state.users.map(user => {
                                        const isTempBlocked = this.state.tempBlocks[user.id];
                                        const canModerate = this.state.user.role === 'superadmin' || 
                                                           (this.state.user.role === 'admin' && user.role !== 'superadmin');
                                        return `
                                            <div class="flex items-center justify-between p-3 border rounded-lg">
                                                <div class="flex items-center gap-3">
                                                    <img src="${user.avatar}" class="w-10 h-10 rounded-full">
                                                    <div>
                                                        <div class="font-medium">${user.username}</div>
                                                        <div class="text-sm text-gray-500">@${user.login}</div>
                                                    </div>
                                                </div>
                                                
                                                <div class="flex items-center gap-2">
                                                    ${this.getStatusBadge(user.status, user.customStatus)}
                                                    
                                                    ${canModerate ? `
                                                        <button onclick="app.state.selectedUserForStatus='${user.id}'; 
                                                                        app.state.newStatus='${user.status}'; 
                                                                        app.state.newCustomStatus='${user.customStatus}'; 
                                                                        app.state.page='editStatus'; app.render();"
                                                                class="px-3 py-1 bg-blue-100 text-blue-800 rounded text-sm hover:bg-blue-200">
                                                            –°—Ç–∞—Ç—É—Å
                                                        </button>
                                                        
                                                        <button onclick="app.tempBlockUser('${user.id}', 60)"
                                                                class="px-3 py-1 bg-red-100 text-red-800 rounded text-sm hover:bg-red-200">
                                                            –ë–ª–æ–∫—Ç–æ–æ
                                                        </button>
                                                        
                                                        ${isTempBlocked ? `
                                                            <button onclick="app.unblockUser('${user.id}')"
                                                                    class="px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700">
                                                                –ê—á—É—É
                                                            </button>
                                                        ` : ''}
                                                    ` : ''}
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            renderEditStatus() {
                const user = this.state.users.find(u => u.id === this.state.selectedUserForStatus);
                if (!user) {
                    this.state.page = 'admin';
                    return this.render();
                }
                
                return `
                    <div class="min-h-screen flex items-center justify-center bg-gray-50 p-4">
                        <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md">
                            <div class="text-center mb-6">
                                <h1 class="text-2xl font-bold text-gray-800">–°—Ç–∞—Ç—É—Å ”©–∑–≥”©—Ä—Ç“Ø“Ø</h1>
                                <p class="text-gray-600">${user.username} “Ø—á“Ø–Ω</p>
                            </div>
                            
                            <div class="space-y-6">
                                <div class="text-center">
                                    <img src="${user.avatar}" class="w-16 h-16 rounded-full mx-auto mb-2">
                                    <p class="font-medium">${user.username}</p>
                                    <p class="text-sm text-gray-500">@${user.login}</p>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        –°—Ç–∞—Ç—É—Å
                                    </label>
                                    <div class="grid grid-cols-2 gap-2">
                                        <button onclick="app.state.newStatus='user'; app.render();"
                                                class="p-3 rounded-lg ${this.state.newStatus==='user'?'status-user':'bg-gray-100'}">
                                            üë§ –ö–æ–ª–¥–æ–Ω—É—É—á—É
                                        </button>
                                        <button onclick="app.state.newStatus='vip'; app.render();"
                                                class="p-3 rounded-lg ${this.state.newStatus==='vip'?'status-vip':'bg-gray-100'}">
                                            ‚≠ê VIP
                                        </button>
                                        <button onclick="app.state.newStatus='admin'; app.render();"
                                                class="p-3 rounded-lg ${this.state.newStatus==='admin'?'status-admin':'bg-gray-100'}">
                                            üõ°Ô∏è –ê–¥–º–∏–Ω
                                        </button>
                                        ${this.state.user.role === 'superadmin' ? `
                                            <button onclick="app.state.newStatus='creator'; app.render();"
                                                    class="p-3 rounded-lg ${this.state.newStatus==='creator'?'status-creator':'bg-gray-100'}">
                                                üëë –°–æ–∑–¥–∞—Ç–µ–ª—å
                                            </button>
                                        ` : ''}
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        ”®–∑–≥”©—á”© –∞—Ç
                                    </label>
                                    <input
                                        type="text"
                                        value="${this.state.newCustomStatus}"
                                        oninput="app.state.newCustomStatus=this.value"
                                        class="w-full border border-gray-300 rounded-lg px-4 py-3"
                                        placeholder="–°—Ç–∞—Ç—É—Å –∞—Ç—ã"
                                    />
                                </div>
                                
                                <div class="flex gap-3 pt-4">
                                    <button
                                        onclick="app.updateUserStatus('${user.id}', app.state.newStatus, app.state.newCustomStatus); 
                                                app.state.page='admin'; app.render();"
                                        class="flex-1 bg-gradient-to-r from-green-600 to-blue-600 text-white font-semibold py-3 rounded-lg hover:opacity-90"
                                    >
                                        –°–∞–∫—Ç–æ–æ
                                    </button>
                                    
                                    <button
                                        onclick="app.state.page='admin'; app.render();"
                                        class="flex-1 border-2 border-gray-300 text-gray-700 font-semibold py-3 rounded-lg hover:bg-gray-50"
                                    >
                                        –ê—Ä—Ç–∫–∞
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }
        
        // Initialize app
        window.app = new JAbadChat();
    </script>
</body>
</html>
