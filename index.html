<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jalaabad Chat | –ñ–∞–ª–∞–ª–∞–±–∞–¥ –ö–æ–ª–ª–µ–¥–∂</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .status-creator { background: linear-gradient(45deg, #f59e0b, #dc2626); color: white; }
        .status-admin { background: linear-gradient(45deg, #3b82f6, #1d4ed8); color: white; }
        .status-moderator { background: linear-gradient(45deg, #10b981, #059669); color: white; }
        .status-vip { background: linear-gradient(45deg, #8b5cf6, #7c3aed); color: white; }
        .status-user { background: #6b7280; color: white; }
        
        .message-bubble { max-width: 70%; border-radius: 18px; }
        .message-bubble.sent { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; margin-left: auto; }
        .message-bubble.received { background: #f3f4f6; color: #374151; margin-right: auto; }
        
        .online-dot { width: 10px; height: 10px; background: #10b981; border-radius: 50%; position: absolute; bottom: 0; right: 0; border: 2px solid white; }
        
        /* Group chat colors */
        .group-1 { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .group-2 { background: linear-gradient(135deg, #10b981, #059669); }
        .group-3 { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .group-4 { background: linear-gradient(135deg, #ec4899, #db2777); }
        
        /* Bad words highlight */
        .bad-word { background-color: #fee2e2; color: #dc2626; padding: 2px 4px; border-radius: 4px; }
        
        /* Temporary block */
        .temp-blocked { opacity: 0.5; position: relative; }
        .temp-blocked::after { 
            content: 'üö´ –ë–ª–æ–∫'; 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            background: rgba(220, 38, 38, 0.9); 
            color: white; 
            padding: 4px 8px; 
            border-radius: 4px; 
            font-size: 12px; 
            z-index: 10; 
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app" class="min-h-screen"></div>

    <script>
        // Jalaabad Chat with Groups and Moderation
        class JalaabadChat {
            constructor() {
                this.state = {
                    page: 'login',
                    user: null,
                    messages: [], // All messages
                    privateMessages: [], // Private messages
                    groupMessages: {}, // Group messages {groupId: [messages]}
                    users: [],
                    groups: [],
                    newMessage: '',
                    selectedChat: null, // null for public, userId for private, groupId for group
                    chatType: 'public', // public, private, group
                    
                    // Registration
                    regUsername: '',
                    regLogin: '', // New: Login instead of phone
                    regPassword: '',
                    regAvatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=user',
                    
                    // Group creation
                    newGroupName: '',
                    newGroupDesc: '',
                    selectedGroupMembers: [],
                    
                    // Admin moderation
                    badWords: ['–∂–∞–º–∞–Ω', '—É—É—Ä–¥–∞', '—É—Ä—É–ø', '–∫–æ—Ä–¥—É–∫', '–∫–∞—Ä–∞', '—ç–º–Ω–µ', '–∫–µ–º–∏', '—á–∞–ø', '—Å–æ–≥'],
                    tempBlocks: {}, // {userId: blockUntilTimestamp}
                    reportedMessages: [], // Reported messages for moderation
                    
                    // Edit user status
                    editingUser: null,
                    newStatus: 'user',
                    customStatus: ''
                };
                
                this.init();
            }
            
            init() {
                // Load from localStorage
                const savedUser = localStorage.getItem('jalaabad_user');
                const savedMessages = localStorage.getItem('jalaabad_messages');
                const savedPrivate = localStorage.getItem('jalaabad_private');
                const savedGroupMessages = localStorage.getItem('jalaabad_group_messages');
                const savedUsers = localStorage.getItem('jalaabad_users');
                const savedGroups = localStorage.getItem('jalaabad_groups');
                const savedTempBlocks = localStorage.getItem('jalaabad_tempblocks');
                const savedReports = localStorage.getItem('jalaabad_reports');
                
                if (savedUser) this.state.user = JSON.parse(savedUser);
                if (savedMessages) this.state.messages = JSON.parse(savedMessages);
                if (savedPrivate) this.state.privateMessages = JSON.parse(savedPrivate);
                if (savedGroupMessages) this.state.groupMessages = JSON.parse(savedGroupMessages);
                if (savedUsers) this.state.users = JSON.parse(savedUsers);
                if (savedGroups) this.state.groups = JSON.parse(savedGroups);
                if (savedTempBlocks) this.state.tempBlocks = JSON.parse(savedTempBlocks);
                if (savedReports) this.state.reportedMessages = JSON.parse(savedReports);
                
                // Check temp blocks expiration
                this.checkTempBlocks();
                
                // Create default data if empty
                if (this.state.users.length === 0) this.createDefaultUsers();
                if (this.state.groups.length === 0) this.createDefaultGroups();
                if (!this.state.groupMessages) this.state.groupMessages = {};
                
                this.render();
            }
            
            checkTempBlocks() {
                const now = Date.now();
                for (const userId in this.state.tempBlocks) {
                    if (this.state.tempBlocks[userId] < now) {
                        delete this.state.tempBlocks[userId];
                    }
                }
                this.saveTempBlocks();
            }
            
            saveAll() {
                if (this.state.user) localStorage.setItem('jalaabad_user', JSON.stringify(this.state.user));
                localStorage.setItem('jalaabad_messages', JSON.stringify(this.state.messages));
                localStorage.setItem('jalaabad_private', JSON.stringify(this.state.privateMessages));
                localStorage.setItem('jalaabad_group_messages', JSON.stringify(this.state.groupMessages));
                localStorage.setItem('jalaabad_users', JSON.stringify(this.state.users));
                localStorage.setItem('jalaabad_groups', JSON.stringify(this.state.groups));
                localStorage.setItem('jalaabad_tempblocks', JSON.stringify(this.state.tempBlocks));
                localStorage.setItem('jalaabad_reports', JSON.stringify(this.state.reportedMessages));
            }
            
            createDefaultUsers() {
                // Creator - exm_404
                const creator = {
                    id: '1',
                    username: 'exm_404',
                    login: 'exm_404',
                    password: 'eluxa',
                    avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=exm404',
                    status: 'creator',
                    customStatus: '–ü—Ä–æ–µ–∫—Ç—Ç–∏–Ω –°–æ–∑–¥–∞—Ç–µ–ª–∏',
                    role: 'superadmin',
                    vipLevel: 10,
                    isOnline: true,
                    isBlocked: false,
                    registeredAt: new Date().toISOString()
                };
                
                // Admin
                const admin = {
                    id: '2',
                    username: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
                    login: 'admin',
                    password: 'admin123',
                    avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=admin',
                    status: 'admin',
                    customStatus: '–°–∏—Å—Ç–µ–º–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã',
                    role: 'admin',
                    vipLevel: 5,
                    isOnline: true,
                    isBlocked: false,
                    registeredAt: new Date().toISOString()
                };
                
                // Moderator
                const moderator = {
                    id: '3',
                    username: '–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä',
                    login: 'moderator',
                    password: 'mod123',
                    avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=moderator',
                    status: 'moderator',
                    customStatus: '–ö–æ–Ω—Ç–µ–Ω—Ç –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã',
                    role: 'moderator',
                    vipLevel: 3,
                    isOnline: true,
                    isBlocked: false,
                    registeredAt: new Date().toISOString()
                };
                
                // Sample VIP
                const vip = {
                    id: '4',
                    username: 'VIP –°—Ç—É–¥–µ–Ω—Ç',
                    login: 'vip',
                    password: 'vip123',
                    avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=vip',
                    status: 'vip',
                    customStatus: '–ê–∫—Ç–∏–≤–¥“Ø“Ø —Å—Ç—É–¥–µ–Ω—Ç',
                    role: 'user',
                    vipLevel: 2,
                    isOnline: true,
                    isBlocked: false,
                    registeredAt: new Date().toISOString()
                };
                
                this.state.users = [creator, admin, moderator, vip];
                this.saveAll();
            }
            
            createDefaultGroups() {
                const groups = [
                    {
                        id: 'g1',
                        name: '3-–ö—É—Ä—Å',
                        description: '3-–∫—É—Ä—Å —Å—Ç—É–¥–µ–Ω—Ç—Ç–µ—Ä–∏',
                        avatar: 'üë®‚Äçüéì',
                        color: 'group-1',
                        creator: '1',
                        admins: ['1', '2'],
                        members: ['1', '2', '3', '4'],
                        isPublic: true,
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'g2',
                        name: '–ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—Ç–µ—Ä',
                        description: 'IT –±”©–ª“Ø–º“Ø',
                        avatar: 'üíª',
                        color: 'group-2',
                        creator: '2',
                        admins: ['2'],
                        members: ['1', '2', '4'],
                        isPublic: true,
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'g3',
                        name: '–ñ–∞–∫—ã–Ω–¥–∞—Ä',
                        description: '–î–æ—Å—É–º –º–µ–Ω–µ–Ω',
                        avatar: 'üë•',
                        color: 'group-3',
                        creator: '4',
                        admins: ['4'],
                        members: ['1', '4'],
                        isPublic: false,
                        createdAt: new Date().toISOString()
                    }
                ];
                
                this.state.groups = groups;
                this.saveAll();
            }
            
            // LOGIN with username/password (not phone)
            login(login, password) {
                // Creator login - exm_404
                if (login === 'exm_404' && password === 'eluxa') {
                    this.state.user = this.state.users.find(u => u.id === '1');
                    if (this.state.user) {
                        this.state.user.isOnline = true;
                        this.state.page = 'chat';
                        this.saveAll();
                        this.render();
                    }
                    return;
                }
                
                // Regular user login
                const user = this.state.users.find(u => 
                    u.login === login && u.password === password
                );
                
                if (user) {
                    if (user.isBlocked) {
                        alert('–°–∏–∑–¥–∏–Ω –∞–∫–∫–∞—É–Ω—Ç—É“£—É–∑ –±–ª–æ–∫—Ç–æ—Ä—É–ª–≥–∞–Ω!');
                        return;
                    }
                    
                    // Check temporary block
                    if (this.state.tempBlocks[user.id]) {
                        const blockUntil = new Date(this.state.tempBlocks[user.id]);
                        const now = new Date();
                        if (blockUntil > now) {
                            const remaining = Math.ceil((blockUntil - now) / 60000); // minutes
                            alert(`–°–∏–∑ —É–±–∞–∫—Ç—ã–ª—É—É –±–ª–æ–∫—Ç–æ—Ä—É–ª–¥—É“£—É–∑! ${remaining} –º“Ø–Ω”©—Ç –∫–∞–ª–¥—ã.`);
                            return;
                        } else {
                            delete this.state.tempBlocks[user.id];
                        }
                    }
                    
                    user.isOnline = true;
                    this.state.user = user;
                    this.state.page = 'chat';
                    this.saveAll();
                    this.render();
                } else {
                    alert('–ö–∞—Ç–∞ –ª–æ–≥–∏–Ω –∂–µ —Å—ã—Ä—Å”©–∑!');
                }
            }
            
            register() {
                if (!this.state.regUsername || !this.state.regLogin || !this.state.regPassword) {
                    alert('–ë–∞–∞—Ä—ã–Ω —Ç–æ–ª—Ç—É—Ä—É“£—É–∑!');
                    return;
                }
                
                // Check if login already exists
                if (this.state.users.some(u => u.login === this.state.regLogin)) {
                    alert('–ë—É–ª –ª–æ–≥–∏–Ω –º—É—Ä—É–Ω—Ç–∞–Ω —ç–ª–µ –∫–∞—Ç—Ç–∞–ª–≥–∞–Ω!');
                    return;
                }
                
                const newUser = {
                    id: Date.now().toString(),
                    username: this.state.regUsername,
                    login: this.state.regLogin,
                    password: this.state.regPassword,
                    avatar: this.state.regAvatar,
                    status: 'user',
                    customStatus: '',
                    role: 'user',
                    vipLevel: 0,
                    isOnline: true,
                    isBlocked: false,
                    registeredAt: new Date().toISOString()
                };
                
                this.state.users.push(newUser);
                this.state.user = newUser;
                this.state.page = 'chat';
                
                // Reset form
                this.state.regUsername = '';
                this.state.regLogin = '';
                this.state.regPassword = '';
                this.state.regAvatar = 'https://api.dicebear.com/7.x/avataaars/svg?seed=user';
                
                this.saveAll();
                this.render();
                
                alert('–ö–∞—Ç—Ç–∞–ª–¥—ã“£—ã–∑! –ö–æ—à –∫–µ–ª–∏“£–∏–∑, ' + newUser.username);
            }
            
            // GROUP FUNCTIONS
            createGroup() {
                if (!this.state.newGroupName.trim()) {
                    alert('–ì—Ä—É–ø–ø–∞–Ω—ã–Ω –∞—Ç—ã–Ω –∂–∞–∑—ã“£—ã–∑!');
                    return;
                }
                
                const newGroup = {
                    id: 'g' + Date.now().toString(),
                    name: this.state.newGroupName,
                    description: this.state.newGroupDesc,
                    avatar: 'üë•',
                    color: `group-${(this.state.groups.length % 4) + 1}`,
                    creator: this.state.user.id,
                    admins: [this.state.user.id],
                    members: [this.state.user.id, ...this.state.selectedGroupMembers],
                    isPublic: true,
                    createdAt: new Date().toISOString()
                };
                
                this.state.groups.push(newGroup);
                this.state.newGroupName = '';
                this.state.newGroupDesc = '';
                this.state.selectedGroupMembers = [];
                this.state.groupMessages[newGroup.id] = [];
                
                this.saveAll();
                this.render();
                
                alert('–ì—Ä—É–ø–ø–∞ —Ç“Ø–∑“Ø–ª–¥“Ø: ' + newGroup.name);
            }
            
            joinGroup(groupId) {
                const group = this.state.groups.find(g => g.id === groupId);
                if (group && !group.members.includes(this.state.user.id)) {
                    group.members.push(this.state.user.id);
                    this.saveAll();
                    this.render();
                }
            }
            
            leaveGroup(groupId) {
                const group = this.state.groups.find(g => g.id === groupId);
                if (group) {
                    group.members = group.members.filter(id => id !== this.state.user.id);
                    group.admins = group.admins.filter(id => id !== this.state.user.id);
                    this.saveAll();
                    this.render();
                }
            }
            
            // MODERATION FUNCTIONS
            checkBadWords(text) {
                const lowerText = text.toLowerCase();
                for (const word of this.state.badWords) {
                    if (lowerText.includes(word.toLowerCase())) {
                        return word;
                    }
                }
                return null;
            }
            
            sendMessage() {
                if (!this.state.newMessage.trim()) return;
                
                // Check for bad words
                const badWord = this.checkBadWords(this.state.newMessage);
                if (badWord && this.state.user.role !== 'admin' && this.state.user.role !== 'superadmin') {
                    if (confirm(`"${badWord}" —Å–æ–∑—É –∂–∞–∑—ã–ª–±–∞—à—ã –∫–µ—Ä–µ–∫! –ñ”©–Ω”©—Ç”©–π“Ø–Ω–±—É?`)) {
                        // Continue sending
                    } else {
                        return;
                    }
                }
                
                const message = {
                    id: Date.now().toString(),
                    text: this.state.newMessage,
                    senderId: this.state.user.id,
                    senderName: this.state.user.username,
                    senderAvatar: this.state.user.avatar,
                    senderStatus: this.state.user.status,
                    timestamp: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                    date: new Date().toLocaleDateString(),
                    hasBadWord: !!badWord,
                    reported: false
                };
                
                // Save based on chat type
                if (this.state.chatType === 'public') {
                    this.state.messages.push(message);
                } else if (this.state.chatType === 'private' && this.state.selectedChat) {
                    this.state.privateMessages.push({
                        ...message,
                        receiverId: this.state.selectedChat
                    });
                } else if (this.state.chatType === 'group' && this.state.selectedChat) {
                    if (!this.state.groupMessages[this.state.selectedChat]) {
                        this.state.groupMessages[this.state.selectedChat] = [];
                    }
                    this.state.groupMessages[this.state.selectedChat].push(message);
                }
                
                this.state.newMessage = '';
                this.saveAll();
                this.render();
            }
            
            // REPORT MESSAGE
            reportMessage(messageId, chatType, chatId) {
                const reportedMsg = {
                    messageId,
                    chatType,
                    chatId,
                    reportedBy: this.state.user.id,
                    reportedAt: new Date().toISOString(),
                    status: 'pending'
                };
                
                this.state.reportedMessages.push(reportedMsg);
                this.saveAll();
                alert('–ë–∏–ª–¥–∏—Ä“Ø“Ø –∫–∞—Ä–∞–ª—É—É–≥–∞ –∂”©–Ω”©—Ç“Ø–ª–¥“Ø!');
            }
            
            // TEMPORARY BLOCK USER
            tempBlockUser(userId, minutes = 60) {
                const blockUntil = Date.now() + (minutes * 60000);
                this.state.tempBlocks[userId] = blockUntil;
                
                const user = this.state.users.find(u => u.id === userId);
                if (user) {
                    user.isOnline = false;
                }
                
                this.saveAll();
                this.render();
                
                alert(`${user?.username || '–ö–æ–ª–¥–æ–Ω—É—É—á—É'} ${minutes} –º“Ø–Ω”©—Ç–∫”© –±–ª–æ–∫—Ç–æ—Ä—É–ª–¥—É!`);
            }
            
            // UNBLOCK USER
            unblockUser(userId) {
                delete this.state.tempBlocks[userId];
                const user = this.state.users.find(u => u.id === userId);
                if (user) {
                    user.isBlocked = false;
                }
                this.saveAll();
                this.render();
            }
            
            // DELETE MESSAGE (for admins)
            deleteMessage(messageId, chatType, chatId) {
                if (confirm('–ë—É–ª –±–∏–ª–¥–∏—Ä“Ø“Ø–Ω“Ø ”©—á“Ø—Ä“Ø“Ø–Ω“Ø –∫–∞–∞–ª–∞–π—Å—ã–∑–±—ã?')) {
                    if (chatType === 'public') {
                        this.state.messages = this.state.messages.filter(m => m.id !== messageId);
                    } else if (chatType === 'group' && chatId) {
                        if (this.state.groupMessages[chatId]) {
                            this.state.groupMessages[chatId] = this.state.groupMessages[chatId].filter(m => m.id !== messageId);
                        }
                    }
                    
                    // Remove from reports
                    this.state.reportedMessages = this.state.reportedMessages.filter(r => r.messageId !== messageId);
                    
                    this.saveAll();
                    this.render();
                }
            }
            
            // VIEW PRIVATE CHATS (for admins)
            getPrivateChats() {
                const chats = {};
                this.state.privateMessages.forEach(msg => {
                    const chatId = [msg.senderId, msg.receiverId].sort().join('_');
                    if (!chats[chatId]) {
                        const user1 = this.state.users.find(u => u.id === msg.senderId);
                        const user2 = this.state.users.find(u => u.id === msg.receiverId);
                        chats[chatId] = {
                            user1: user1?.username || '–ë–µ–ª–≥–∏—Å–∏–∑',
                            user2: user2?.username || '–ë–µ–ª–≥–∏—Å–∏–∑',
                            userId1: msg.senderId,
                            userId2: msg.receiverId,
                            messages: []
                        };
                    }
                    chats[chatId].messages.push(msg);
                });
                return Object.values(chats);
            }
            
            getStatusBadge(status, customStatus = '') {
                const statusText = customStatus || 
                    (status === 'creator' ? '–°–æ–∑–¥–∞—Ç–µ–ª—å' :
                     status === 'admin' ? '–ê–¥–º–∏–Ω' :
                     status === 'moderator' ? '–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä' :
                     status === 'vip' ? 'VIP' : '–ö–æ–ª–¥–æ–Ω—É—É—á—É');
                
                return `<span class="px-2 py-1 rounded-full text-xs font-medium status-${status}">${statusText}</span>`;
            }
            
            logout() {
                if (this.state.user) {
                    const user = this.state.users.find(u => u.id === this.state.user.id);
                    if (user) user.isOnline = false;
                }
                
                this.state.user = null;
                this.state.page = 'login';
                localStorage.removeItem('jalaabad_user');
                this.saveAll();
                this.render();
            }
            
            // RENDER FUNCTIONS
            render() {
                const app = document.getElementById('app');
                
                switch(this.state.page) {
                    case 'login': app.innerHTML = this.renderLogin(); break;
                    case 'register': app.innerHTML = this.renderRegister(); break;
                    case 'chat': app.innerHTML = this.renderChat(); break;
                    case 'groups': app.innerHTML = this.renderGroups(); break;
                    case 'createGroup': app.innerHTML = this.renderCreateGroup(); break;
                    case 'admin': app.innerHTML = this.renderAdmin(); break;
                    case 'moderation': app.innerHTML = this.renderModeration(); break;
                    case 'privateChats': app.innerHTML = this.renderPrivateChats(); break;
                }
            }
            
            renderLogin() {
                return `
                    <div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-purple-50 p-4">
                        <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md">
                            <div class="text-center mb-8">
                                <div class="gradient-bg w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i class="fas fa-mountains text-white text-3xl"></i>
                                </div>
                                <h1 class="text-3xl font-bold text-gray-800">Jalaabad Chat</h1>
                                <p class="text-gray-600 mt-2">–ñ–∞–ª–∞–ª–∞–±–∞–¥ –ö–æ–ª–ª–µ–¥–∂–¥–∏–Ω —á–∞—Ç —Å–∏—Å—Ç–µ–º–∞—Å—ã</p>
                            </div>
                            
                            <form onsubmit="event.preventDefault(); app.login(
                                document.getElementById('loginInput').value,
                                document.getElementById('loginPass').value
                            )" class="space-y-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-user mr-2"></i>–õ–æ–≥–∏–Ω
                                    </label>
                                    <input
                                        type="text"
                                        id="loginInput"
                                        class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        placeholder="–õ–æ–≥–∏–Ω“Ø–∑"
                                        required
                                    />
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-lock mr-2"></i>–°—ã—Ä—Å”©–∑
                                    </label>
                                    <input
                                        type="password"
                                        id="loginPass"
                                        class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        placeholder="–°—ã—Ä—Å”©–∑“Ø“£“Ø–∑"
                                        required
                                    />
                                </div>
                                
                                <button
                                    type="submit"
                                    class="gradient-bg w-full text-white font-semibold py-3 px-4 rounded-lg hover:opacity-90 transition-opacity"
                                >
                                    –ö–∏—Ä“Ø“Ø
                                </button>
                                
                                <button
                                    type="button"
                                    onclick="app.state.page='register'; app.render();"
                                    class="w-full border-2 border-gray-300 text-gray-700 font-semibold py-3 px-4 rounded-lg hover:bg-gray-50 transition-colors"
                                >
                                    –ñ–∞“£—ã –∫–∞—Ç—Ç–∞–ª—É—É
                                </button>
                                
                                <div class="text-center text-sm text-gray-600 border-t pt-4">
                                    <p class="font-semibold mb-2">–¢–µ—Å—Ç –∞–∫–∫–∞—É–Ω—Ç—Ç–∞—Ä:</p>
                                    <div class="space-y-1 text-xs">
                                        <p>üëë <strong>exm_404</strong> / eluxa (–°–æ–∑–¥–∞—Ç–µ–ª—å)</p>
                                        <p>üõ°Ô∏è <strong>admin</strong> / admin123 (–ê–¥–º–∏–Ω)</p>
                                        <p>üõ°Ô∏è <strong>moderator</strong> / mod123 (–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä)</p>
                                        <p>‚≠ê <strong>vip</strong> / vip123 (VIP —Å—Ç—É–¥–µ–Ω—Ç)</p>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
            }
            
            renderRegister() {
                return `
                    <div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-green-50 to-blue-50 p-4">
                        <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md">
                            <div class="text-center mb-6">
                                <h1 class="text-2xl font-bold text-gray-800">–ñ–∞“£—ã –∫–∞—Ç—Ç–∞–ª—É—É</h1>
                                <p class="text-gray-600">Jalaabad Chat —Å–∏—Å—Ç–µ–º–∞—Å—ã–Ω–∞ –∫–∞—Ç—Ç–∞–ª—ã“£—ã–∑</p>
                            </div>
                            
                            <form onsubmit="event.preventDefault(); app.register();" class="space-y-4">
                                <input
                                    type="text"
                                    value="${this.state.regUsername}"
                                    oninput="app.state.regUsername=this.value"
                                    class="w-full border border-gray-300 rounded-lg px-4 py-3"
                                    placeholder="–¢–æ–ª—É–∫ –∞—Ç—ã-–∂”©–Ω“Ø“£“Ø–∑"
                                    required
                                />
                                
                                <input
                                    type="text"
                                    value="${this.state.regLogin}"
                                    oninput="app.state.regLogin=this.value"
                                    class="w-full border border-gray-300 rounded-lg px-4 py-3"
                                    placeholder="–õ–æ–≥–∏–Ω (–∫–æ–ª–¥–æ–Ω—É—É—á—É –∞—Ç—ã)"
                                    required
                                />
                                
                                <input
                                    type="password"
                                    value="${this.state.regPassword}"
                                    oninput="app.state.regPassword=this.value"
                                    class="w-full border border-gray-300 rounded-lg px-4 py-3"
                                    placeholder="–ö—É–ø—É—è —Å—ã—Ä—Å”©–∑"
                                    required
                                />
                                
                                <div class="flex gap-3 pt-2">
                                    <button
                                        type="submit"
                                        class="flex-1 bg-gradient-to-r from-green-600 to-blue-600 text-white font-semibold py-3 rounded-lg hover:opacity-90"
                                    >
                                        –ö–∞—Ç—Ç–∞–ª—É—É
                                    </button>
                                    
                                    <button
                                        type="button"
                                        onclick="app.state.page='login'; app.render();"
                                        class="flex-1 border-2 border-gray-300 text-gray-700 font-semibold py-3 rounded-lg hover:bg-gray-50"
                                    >
                                        –ê—Ä—Ç–∫–∞
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
            }
            
            renderChat() {
                const currentMessages = this.state.chatType === 'public' ? this.state.messages :
                                      this.state.chatType === 'private' ? 
                                        this.state.privateMessages.filter(m => 
                                            m.senderId === this.state.selectedChat || 
                                            m.receiverId === this.state.selectedChat
                                        ) :
                                      this.state.chatType === 'group' && this.state.selectedChat ?
                                        this.state.groupMessages[this.state.selectedChat] || [] : [];
                
                const currentUser = this.state.selectedChat && this.state.chatType === 'private' ? 
                    this.state.users.find(u => u.id === this.state.selectedChat) : null;
                
                const currentGroup = this.state.selectedChat && this.state.chatType === 'group' ?
                    this.state.groups.find(g => g.id === this.state.selectedChat) : null;
                
                return `
                    <div class="flex h-screen bg-gray-100">
                        <!-- Left Sidebar - Chats -->
                        <div class="w-20 bg-white border-r flex flex-col">
                            <div class="p-4">
                                <div class="gradient-bg w-12 h-12 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-mountains text-white text-xl"></i>
                                </div>
                            </div>
                            
                            <div class="flex-1 py-4 space-y-2">
                                <!-- Public Chat -->
                                <button onclick="app.state.chatType='public'; app.state.selectedChat=null; app.render();"
                                        class="w-full p-3 ${this.state.chatType==='public'?'bg-blue-50 text-blue-600':'text-gray-500'} hover:bg-gray-100">
                                    <i class="fas fa-globe"></i>
                                </button>
                                
                                <!-- Groups -->
                                <button onclick="app.state.page='groups'; app.render();"
                                        class="w-full p-3 text-gray-500 hover:bg-gray-100">
                                    <i class="fas fa-users"></i>
                                </button>
                                
                                <!-- Admin Panel -->
                                ${this.state.user.role === 'admin' || this.state.user.role === 'superadmin' ? `
                                    <button onclick="app.state.page='admin'; app.render();"
                                            class="w-full p-3 text-gray-500 hover:bg-gray-100">
                                        <i class="fas fa-shield-alt"></i>
                                    </button>
                                ` : ''}
                            </div>
                            
                            <!-- User Profile -->
                            <div class="p-4 border-t">
                                <div class="relative">
                                    <img src="${this.state.user.avatar}" class="w-10 h-10 rounded-full">
                                    <div class="online-dot"></div>
                                </div>
                                <button onclick="app.logout()" class="w-full mt-4 p-2 text-gray-500 hover:text-red-600">
                                    <i class="fas fa-sign-out-alt"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Middle - Chat List -->
                        <div class="w-64 bg-white border-r">
                            <div class="p-4 border-b">
                                <h2 class="font-semibold text-gray-800">–ß–∞—Ç—Ç–∞—Ä</h2>
                            </div>
                            
                            <div class="overflow-y-auto h-full">
                                <!-- Public Chat -->
                                <div onclick="app.state.chatType='public'; app.state.selectedChat=null; app.render();"
                                     class="p-3 border-b hover:bg-gray-50 cursor-pointer ${this.state.chatType==='public'?'bg-blue-50':''}">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center">
                                            <i class="fas fa-globe text-blue-600"></i>
                                        </div>
                                        <div>
                                            <div class="font-medium">–ñ–∞–ª–ø—ã —á–∞—Ç</div>
                                            <div class="text-xs text-gray-500">${this.state.messages.length} –±–∏–ª–¥–∏—Ä“Ø“Ø</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Users for Private Chat -->
                                <div class="p-2 text-xs text-gray-500 font-medium">–ñ–µ–∫–µ —á–∞—Ç—Ç–∞—Ä</div>
                                ${this.state.users.filter(u => u.id !== this.state.user.id).map(user => `
                                    <div onclick="app.state.chatType='private'; app.state.selectedChat='${user.id}'; app.render();"
                                         class="p-3 hover:bg-gray-50 cursor-pointer ${this.state.chatType==='private'&&this.state.selectedChat===user.id?'bg-blue-50':''}">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center gap-3">
                                                <div class="relative">
                                                    <img src="${user.avatar}" class="w-8 h-8 rounded-full">
                                                    ${user.isOnline && !this.state.tempBlocks[user.id] ? '<div class="online-dot"></div>' : ''}
                                                </div>
                                                <div>
                                                    <div class="font-medium">${user.username}</div>
                                                    <div class="text-xs text-gray-500">${user.status}</div>
                                                </div>
                                            </div>
                                            ${this.state.tempBlocks[user.id] ? '<span class="text-xs text-red-600">üö´</span>' : ''}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- Main Chat Area -->
                        <div class="flex-1 flex flex-col">
                            <!-- Chat Header -->
                            <div class="bg-white border-b p-4">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        ${this.state.chatType === 'public' ? `
                                            <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center">
                                                <i class="fas fa-globe text-blue-600"></i>
                                            </div>
                                            <div>
                                                <h1 class="text-xl font-bold text-gray-800">–ñ–∞–ª–ø—ã —á–∞—Ç</h1>
                                                <p class="text-sm text-gray-600">–ë–∞—Ä–¥—ã–∫ –∫–æ–ª–¥–æ–Ω—É—É—á—É–ª–∞—Ä</p>
                                            </div>
                                        ` : this.state.chatType === 'private' && currentUser ? `
                                            <img src="${currentUser.avatar}" class="w-10 h-10 rounded-full">
                                            <div>
                                                <h1 class="text-xl font-bold text-gray-800">${currentUser.username}</h1>
                                                <p class="text-sm text-gray-600">–ñ–µ–∫–µ —á–∞—Ç</p>
                                            </div>
                                        ` : this.state.chatType === 'group' && currentGroup ? `
                                            <div class="w-10 h-10 rounded-full ${currentGroup.color} flex items-center justify-center text-white">
                                                ${currentGroup.avatar}
                                            </div>
                                            <div>
                                                <h1 class="text-xl font-bold text-gray-800">${currentGroup.name}</h1>
                                                <p class="text-sm text-gray-600">${currentGroup.description}</p>
                                            </div>
                                        ` : ''}
                                    </div>
                                    
                                    <div class="flex items-center gap-3">
                                        <div class="text-right">
                                            <div class="font-medium">${this.state.user.username}</div>
                                            <div class="text-xs text-gray-500">${this.state.user.role}</div>
                                        </div>
                                        <img src="${this.state.user.avatar}" class="w-10 h-10 rounded-full">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Messages -->
                            <div class="flex-1 overflow-y-auto p-4 space-y-3">
                                ${currentMessages.map(msg => {
                                    const sender = this.state.users.find(u => u.id === msg.senderId);
                                    const isTempBlocked = this.state.tempBlocks[msg.senderId];
                                    
                                    return `
                                        <div class="${msg.senderId === this.state.user.id ? 'text-right' : 'text-left'} ${isTempBlocked ? 'temp-blocked' : ''}">
                                            <div class="inline-block max-w-xs lg:max-w-md">
                                                <div class="flex items-center gap-2 mb-1 ${msg.senderId === this.state.user.id ? 'justify-end' : 'justify-start'}">
                                                    ${msg.senderId !== this.state.user.id ? `
                                                        <img src="${sender?.avatar || msg.senderAvatar}" class="w-6 h-6 rounded-full">
                                                    ` : ''}
                                                    <span class="font-medium">${msg.senderId === this.state.user.id ? '–°–∏–∑' : msg.senderName}</span>
                                                    <span class="text-xs text-gray-500">${msg.timestamp}</span>
                                                    ${msg.hasBadWord ? '<span class="text-xs text-red-600">‚ö†Ô∏è</span>' : ''}
                                                    ${this.state.user.role === 'admin' || this.state.user.role === 'superadmin' ? `
                                                        <button onclick="app.reportMessage('${msg.id}', '${this.state.chatType}', '${this.state.selectedChat}')" 
                                                                class="text-xs text-gray-400 hover:text-red-600">
                                                            <i class="fas fa-flag"></i>
                                                        </button>
                                                    ` : ''}
                                                </div>
                                                <div class="message-bubble ${msg.senderId === this.state.user.id ? 'sent' : 'received'} px-4 py-3">
                                                    ${msg.hasBadWord ? `<span class="bad-word">${msg.text}</span>` : msg.text}
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                            
                            <!-- Message Input -->
                            <div class="border-t bg-white p-4">
                                <form onsubmit="event.preventDefault(); app.sendMessage();" class="flex gap-2">
                                    <input
                                        type="text"
                                        value="${this.state.newMessage}"
                                        oninput="app.state.newMessage=this.value"
                                        onkeypress="if(event.key==='Enter' && !event.shiftKey) {event.preventDefault(); app.sendMessage();}"
                                        class="flex-1 border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        placeholder="–ë–∏–ª–¥–∏—Ä“Ø“Ø –∂–∞–∑—ã“£—ã–∑..."
                                        ${this.state.tempBlocks[this.state.user.id] ? 'disabled' : ''}
                                    />
                                    <button
                                        type="submit"
                                        class="gradient-bg text-white px-6 py-3 rounded-lg hover:opacity-90 disabled:opacity-50"
                                        ${this.state.tempBlocks[this.state.user.id] ? 'disabled' : ''}
                                    >
                                        <i class="fas fa-paper-plane"></i>
                                    </button>
                                </form>
                                ${this.state.tempBlocks[this.state.user.id] ? `
                                    <div class="text-center text-sm text-red-600 mt-2">
                                        üö´ –°–∏–∑ —É–±–∞–∫—Ç—ã–ª—É—É –±–ª–æ–∫—Ç–æ—Ä—É–ª–¥—É“£—É–∑!
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            renderGroups() {
                const myGroups = this.state.groups.filter(g => g.members.includes(this.state.user.id));
                const otherGroups = this.state.groups.filter(g => !g.members.includes(this.state.user.id) && g.isPublic);
                
                return `
                    <div class="flex h-screen bg-gray-100">
                        <!-- Sidebar -->
                        <div class="w-20 bg-white border-r flex flex-col">
                            <div class="p-4">
                                <div class="gradient-bg w-12 h-12 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-mountains text-white text-xl"></i>
                                </div>
                            </div>
                            
                            <div class="flex-1 py-4 space-y-2">
                                <button onclick="app.state.page='chat'; app.render();"
                                        class="w-full p-3 text-gray-500 hover:bg-gray-100">
                                    <i class="fas fa-arrow-left"></i>
                                </button>
                                
                                <button onclick="app.state.page='createGroup'; app.render();"
                                        class="w-full p-3 text-green-600 hover:bg-green-50">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Groups List -->
                        <div class="flex-1 p-6 overflow-y-auto">
                            <div class="mb-8">
                                <h1 class="text-2xl font-bold text-gray-800">–ì—Ä—É–ø–ø–∞–ª–∞—Ä</h1>
                                <p class="text-gray-600">–ì—Ä—É–ø–ø–∞–ª–∞—Ä–¥—ã –±–∞—à–∫–∞—Ä—É—É –∂–∞–Ω–∞ –∫–∞—Ç—ã—à—É—É</p>
                            </div>
                            
                            <!-- My Groups -->
                            <div class="mb-8">
                                <h2 class="text-lg font-semibold text-gray-800 mb-4">–ú–µ–Ω–∏–Ω –≥—Ä—É–ø–ø–∞–ª–∞—Ä—ã–º</h2>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    ${myGroups.map(group => {
                                        const memberCount = group.members.length;
                                        const isAdmin = group.admins.includes(this.state.user.id);
                                        return `
                                            <div class="bg-white rounded-xl border p-4 hover:shadow-md transition-shadow">
                                                <div class="flex items-center gap-3 mb-3">
                                                    <div class="w-12 h-12 rounded-full ${group.color} flex items-center justify-center text-white text-xl">
                                                        ${group.avatar}
                                                    </div>
                                                    <div>
                                                        <h3 class="font-bold text-gray-800">${group.name}</h3>
                                                        <p class="text-sm text-gray-500">${memberCount} –º“Ø—á”©</p>
                                                    </div>
                                                </div>
                                                <p class="text-sm text-gray-600 mb-4">${group.description || '–°“Ø—Ä”©—Ç—Ç”©–ª–≥”©–Ω –∂–æ–∫'}</p>
                                                <div class="flex justify-between">
                                                    <button onclick="app.state.chatType='group'; app.state.selectedChat='${group.id}'; app.state.page='chat'; app.render();"
                                                            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                                        –ß–∞—Ç–∫–∞ ”©—Ç“Ø“Ø
                                                    </button>
                                                    ${isAdmin ? `
                                                        <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded">
                                                            –ê–¥–º–∏–Ω
                                                        </span>
                                                    ` : `
                                                        <button onclick="app.leaveGroup('${group.id}')"
                                                                class="px-3 py-1 border border-gray-300 text-gray-700 rounded text-sm">
                                                            –ß—ã–≥—É—É
                                                        </button>
                                                    `}
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                            
                            <!-- Available Groups -->
                            ${otherGroups.length > 0 ? `
                                <div>
                                    <h2 class="text-lg font-semibold text-gray-800 mb-4">–ö–æ—à—É–ª—É—É–≥–∞ –±–æ–ª–æ —Ç—É—Ä–≥–∞–Ω –≥—Ä—É–ø–ø–∞–ª–∞—Ä</h2>
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        ${otherGroups.map(group => `
                                            <div class="bg-white rounded-xl border p-4">
                                                <div class="flex items-center gap-3 mb-3">
                                                    <div class="w-12 h-12 rounded-full ${group.color} flex items-center justify-center text-white text-xl">
                                                        ${group.avatar}
                                                    </div>
                                                    <div>
                                                        <h3 class="font-bold text-gray-800">${group.name}</h3>
                                                        <p class="text-sm text-gray-500">${group.members.length} –º“Ø—á”©</p>
                                                    </div>
                                                </div>
                                                <button onclick="app.joinGroup('${group.id}')"
                                                        class="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                                    –ö–æ—à—É–ª—É—É
                                                </button>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }
            
            renderCreateGroup() {
                const availableUsers = this.state.users.filter(u => u.id !== this.state.user.id);
                
                return `
                    <div class="min-h-screen flex items-center justify-center bg-gray-50 p-4">
                        <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md">
                            <div class="text-center mb-6">
                                <h1 class="text-2xl font-bold text-gray-800">–ñ–∞“£—ã –≥—Ä—É–ø–ø–∞</h1>
                                <p class="text-gray-600">–ì—Ä—É–ø–ø–∞ —Ç“Ø–∑“Ø“Ø –∂–∞–Ω–∞ –º“Ø—á”©–ª”©—Ä–¥“Ø —á–∞–∫—ã—Ä—É—É</p>
                            </div>
                            
                            <form onsubmit="event.preventDefault(); app.createGroup();" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">–ì—Ä—É–ø–ø–∞–Ω—ã–Ω –∞—Ç—ã</label>
                                    <input type="text" value="${this.state.newGroupName}"
                                           oninput="app.state.newGroupName=this.value"
                                           class="w-full border border-gray-300 rounded-lg px-4 py-3"
                                           placeholder="–ì—Ä—É–ø–ø–∞–Ω—ã–Ω –∞—Ç—ã" required>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">–°“Ø—Ä”©—Ç—Ç”©–º”©</label>
                                    <textarea oninput="app.state.newGroupDesc=this.value"
                                              class="w-full border border-gray-300 rounded-lg px-4 py-3"
                                              placeholder="–ì—Ä—É–ø–ø–∞–Ω—ã–Ω —Å“Ø—Ä”©—Ç—Ç”©–º”©—Å“Ø"
                                              rows="3">${this.state.newGroupDesc}</textarea>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">–ú“Ø—á”©–ª”©—Ä–¥“Ø —Ç–∞–Ω–¥–∞“£—ã–∑</label>
                                    <div class="space-y-2 max-h-40 overflow-y-auto p-2 border rounded">
                                        ${availableUsers.map(user => `
                                            <div class="flex items-center justify-between p-2 hover:bg-gray-50 rounded">
                                                <div class="flex items-center gap-3">
                                                    <img src="${user.avatar}" class="w-8 h-8 rounded-full">
                                                    <span>${user.username}</span>
                                                </div>
                                                <input type="checkbox" 
                                                       ${this.state.selectedGroupMembers.includes(user.id) ? 'checked' : ''}
                                                       onchange="if(this.checked) app.state.selectedGroupMembers.push('${user.id}');
                                                                else app.state.selectedGroupMembers = app.state.selectedGroupMembers.filter(id => id !== '${user.id}')">
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                                
                                <div class="flex gap-3 pt-4">
                                    <button type="submit"
                                            class="flex-1 bg-gradient-to-r from-green-600 to-blue-600 text-white font-semibold py-3 rounded-lg hover:opacity-90">
                                        –ì—Ä—É–ø–ø–∞ —Ç“Ø–∑“Ø“Ø
                                    </button>
                                    
                                    <button type="button"
                                            onclick="app.state.page='groups'; app.render();"
                                            class="flex-1 border-2 border-gray-300 text-gray-700 font-semibold py-3 rounded-lg hover:bg-gray-50">
                                        –ê—Ä—Ç–∫–∞
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
            }
            
            renderAdmin() {
                const onlineUsers = this.state.users.filter(u => u.isOnline && !this.state.tempBlocks[u.id]);
                const tempBlockedUsers = this.state.users.filter(u => this.state.tempBlocks[u.id]);
                const reportedCount = this.state.reportedMessages.filter(r => r.status === 'pending').length;
                
                return `
                    <div class="flex h-screen bg-gray-100">
                        <!-- Sidebar -->
                        <div class="w-20 bg-white border-r flex flex-col">
                            <div class="p-4">
                                <div class="bg-red-600 w-12 h-12 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-shield-alt text-white text-xl"></i>
                                </div>
                            </div>
                            
                            <div class="flex-1 py-4 space-y-2">
                                <button onclick="app.state.page='chat'; app.render();"
                                        class="w-full p-3 text-gray-500 hover:bg-gray-100">
                                    <i class="fas fa-arrow-left"></i>
                                </button>
                                
                                <button onclick="app.state.page='moderation'; app.render();"
                                        class="w-full p-3 ${reportedCount > 0 ? 'text-red-600' : 'text-gray-500'} hover:bg-gray-100">
                                    <i class="fas fa-flag"></i>
                                    ${reportedCount > 0 ? `<span class="absolute top-2 right-2 w-2 h-2 bg-red-600 rounded-full"></span>` : ''}
                                </button>
                                
                                ${this.state.user.role === 'superadmin' ? `
                                    <button onclick="app.state.page='privateChats'; app.render();"
                                            class="w-full p-3 text-gray-500 hover:bg-gray-100">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                        
                        <!-- Admin Panel -->
                        <div class="flex-1 p-6 overflow-y-auto">
                            <div class="mb-8">
                                <h1 class="text-2xl font-bold text-gray-800 flex items-center gap-3">
                                    <i class="fas fa-shield-alt text-red-600"></i>
                                    –ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª–∏
                                </h1>
                                <p class="text-gray-600 mt-2">–ö–æ–ª–¥–æ–Ω—É—É—á—É–ª–∞—Ä–¥—ã –±–∞—à–∫–∞—Ä—É—É –∂–∞–Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—è</p>
                                <div class="flex items-center gap-2 mt-3">
                                    <span class="px-3 py-1 bg-gradient-to-r from-red-600 to-orange-600 text-white rounded-full text-sm">
                                        ${this.state.user.username}
                                    </span>
                                    <span class="text-sm text-gray-500">${this.state.user.role === 'superadmin' ? '–°–æ–∑–¥–∞—Ç–µ–ª—å' : '–ê–¥–º–∏–Ω'}</span>
                                </div>
                            </div>
                            
                            <!-- Stats -->
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                                <div class="bg-white p-4 rounded-xl border">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-gray-500 text-sm">–û–Ω–ª–∞–π–Ω</p>
                                            <p class="text-2xl font-bold mt-1">${onlineUsers.length}</p>
                                        </div>
                                        <i class="fas fa-users text-green-500"></i>
                                    </div>
                                </div>
                                
                                <div class="bg-white p-4 rounded-xl border">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-gray-500 text-sm">–ë–ª–æ–∫—Ç–æ—Ä—É–ª–≥–∞–Ω</p>
                                            <p class="text-2xl font-bold mt-1 text-red-600">${tempBlockedUsers.length}</p>
                                        </div>
                                        <i class="fas fa-ban text-red-500"></i>
                                    </div>
                                </div>
                                
                                <div class="bg-white p-4 rounded-xl border">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-gray-500 text-sm">–ö–∞—Ä–æ–æ—Å—É–∑</p>
                                            <p class="text-2xl font-bold mt-1 text-orange-600">${reportedCount}</p>
                                        </div>
                                        <i class="fas fa-flag text-orange-500"></i>
                                    </div>
                                </div>
                                
                                <div class="bg-white p-4 rounded-xl border">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-gray-500 text-sm">–ì—Ä—É–ø–ø–∞–ª–∞—Ä</p>
                                            <p class="text-2xl font-bold mt-1">${this.state.groups.length}</p>
                                        </div>
                                        <i class="fas fa-users-cog text-blue-500"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- User Management -->
                            <div class="bg-white rounded-xl border mb-8">
                                <div class="p-4 border-b">
                                    <h2 class="text-lg font-semibold text-gray-800">–ö–æ–ª–¥–æ–Ω—É—É—á—É–ª–∞—Ä</h2>
                                </div>
                                
                                <div class="overflow-x-auto">
                                    <table class="min-w-full">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-500">–ö–æ–ª–¥–æ–Ω—É—É—á—É</th>
                                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-500">–°—Ç–∞—Ç—É—Å</th>
                                                <th class="px-4 py-3 text-left text-sm font-medium text-gray-500">–ê—Ä–∞–∫–µ—Ç—Ç–µ—Ä</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${this.state.users.map(user => {
                                                const isTempBlocked = this.state.tempBlocks[user.id];
                                                const canModerate = this.state.user.role === 'superadmin' || 
                                                                   (this.state.user.role === 'admin' && user.role !== 'superadmin');
                                                return `
                                                    <tr class="border-t hover:bg-gray-50">
                                                        <td class="px-4 py-3">
                                                            <div class="flex items-center gap-3">
                                                                <img src="${user.avatar}" class="w-8 h-8 rounded-full">
                                                                <div>
                                                                    <div class="font-medium">${user.username}</div>
                                                                    <div class="text-xs text-gray-500">${user.login}</div>
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <td class="px-4 py-3">
                                                            ${this.getStatusBadge(user.status, user.customStatus)}
                                                            ${isTempBlocked ? '<span class="text-xs text-red-600 ml-2">üö´ –ë–ª–æ–∫</span>' : ''}
                                                        </td>
                                                        <td class="px-4 py-3 space-x-2">
                                                            ${canModerate ? `
                                                                <button onclick="app.tempBlockUser('${user.id}', 60)"
                                                                        class="px-3 py-1 bg-red-100 text-red-800 rounded text-sm hover:bg-red-200">
                                                                    1 —Å–∞–∞—Ç –±–ª–æ–∫
                                                                </button>
                                                                <button onclick="app.tempBlockUser('${user.id}', 1440)"
                                                                        class="px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700">
                                                                    1 –∫“Ø–Ω –±–ª–æ–∫
                                                                </button>
                                                                ${isTempBlocked ? `
                                                                    <button onclick="app.unblockUser('${user.id}')"
                                                                            class="px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700">
                                                                        –ë–ª–æ–∫—Ç—É –∞—á—É—É
                                                                    </button>
                                                                ` : ''}
                                                            ` : '<span class="text-gray-400">–¢“Ø–∑”©—Ç“Ø“Ø–≥”© –±–æ–ª–±–æ–π—Ç</span>'}
                                                        </td>
                                                    </tr>
                                                `;
                                            }).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            renderModeration() {
                const pendingReports = this.state.reportedMessages.filter(r => r.status === 'pending');
                
                return `
                    <div class="flex h-screen bg-gray-100">
                        <!-- Sidebar -->
                        <div class="w-20 bg-white border-r flex flex-col">
                            <div class="p-4">
                                <div class="bg-orange-600 w-12 h-12 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-flag text-white text-xl"></i>
                                </div>
                            </div>
                            
                            <div class="flex-1 py-4">
                                <button onclick="app.state.page='admin'; app.render();"
                                        class="w-full p-3 text-gray-500 hover:bg-gray-100">
                                    <i class="fas fa-arrow-left"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Moderation Panel -->
                        <div class="flex-1 p-6 overflow-y-auto">
                            <div class="mb-8">
                                <h1 class="text-2xl font-bold text-gray-800 flex items-center gap-3">
                                    <i class="fas fa-flag text-orange-600"></i>
                                    –ú–æ–¥–µ—Ä–∞—Ü–∏—è
                                </h1>
                                <p class="text-gray-600 mt-2">–ö–∞—Ä–æ–æ—Å—É–∑ –±–∏–ª–¥–∏—Ä“Ø“Ø–ª”©—Ä –∂–∞–Ω–∞ —à–∞—à—ã–ª—ã—à—Ç–∞—Ä</p>
                            </div>
                            
                            ${pendingReports.length > 0 ? `
                                <div class="space-y-4">
                                    ${pendingReports.map(report => {
                                        // Find message
                                        let message;
                                        if (report.chatType === 'public') {
                                            message = this.state.messages.find(m => m.id === report.messageId);
                                        } else if (report.chatType === 'group' && report.chatId) {
                                            message = this.state.groupMessages[report.chatId]?.find(m => m.id === report.messageId);
                                        }
                                        
                                        const reporter = this.state.users.find(u => u.id === report.reportedBy);
                                        const sender = message ? this.state.users.find(u => u.id === message.senderId) : null;
                                        
                                        if (!message) return '';
                                        
                                        return `
                                            <div class="bg-white rounded-xl border p-4">
                                                <div class="flex items-center justify-between mb-4">
                                                    <div class="flex items-center gap-3">
                                                        <img src="${sender?.avatar || ''}" class="w-10 h-10 rounded-full">
                                                        <div>
                                                            <div class="font-medium">${sender?.username || '–ë–µ–ª–≥–∏—Å–∏–∑'}</div>
                                                            <div class="text-xs text-gray-500">${message.timestamp}</div>
                                                        </div>
                                                    </div>
                                                    <span class="px-2 py-1 bg-orange-100 text-orange-800 rounded text-xs">
                                                        –ö–∞—Ä–æ–æ—Å—É–∑
                                                    </span>
                                                </div>
                                                
                                                <div class="bg-gray-50 p-3 rounded-lg mb-4">
                                                    <p>${message.text}</p>
                                                    ${message.hasBadWord ? '<div class="text-xs text-red-600 mt-1">‚ö†Ô∏è –ñ–∞–º–∞–Ω —Å”©–∑ —Ç–∞–±—ã–ª–¥—ã</div>' : ''}
                                                </div>
                                                
                                                <div class="flex items-center justify-between">
                                                    <div class="text-sm text-gray-500">
                                                        –®–∏–∫–æ–æ –∫—ã–ª–≥–∞–Ω: ${reporter?.username || '–ë–µ–ª–≥–∏—Å–∏–∑'}
                                                    </div>
                                                    <div class="flex gap-2">
                                                        <button onclick="app.deleteMessage('${message.id}', '${report.chatType}', '${report.chatId}')"
                                                                class="px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700">
                                                            ”®—á“Ø—Ä“Ø“Ø
                                                        </button>
                                                        <button onclick="app.tempBlockUser('${message.senderId}', 60)"
                                                                class="px-3 py-1 bg-orange-600 text-white rounded text-sm hover:bg-orange-700">
                                                            –ë–ª–æ–∫—Ç–æ–æ
                                                        </button>
                                                        <button onclick="
                                                            const idx = app.state.reportedMessages.findIndex(r => r.messageId === '${report.messageId}');
                                                            if (idx > -1) app.state.reportedMessages[idx].status = 'resolved';
                                                            app.saveAll();
                                                            app.render();
                                                        " class="px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700">
                                                            ”®—Ç–∫”©—Ä“Ø–ø –∂–∏–±–µ—Ä“Ø“Ø
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            ` : `
                                <div class="text-center py-12">
                                    <i class="fas fa-check-circle text-green-500 text-4xl mb-4"></i>
                                    <h3 class="text-xl font-medium text-gray-800">–ö–∞—Ä–æ–æ—Å—É–∑ –±–∏–ª–¥–∏—Ä“Ø“Ø–ª”©—Ä –∂–æ–∫</h3>
                                    <p class="text-gray-600 mt-2">–ë–∞–∞—Ä–¥—ã–∫ —à–∏–∫–æ–æ–ª–æ—Ä –∫–∞—Ä–∞–ª–¥—ã</p>
                                </div>
                            `}
                        </div>
                    </div>
                `;
            }
            
            renderPrivateChats() {
                const privateChats = this.getPrivateChats();
                
                return `
                    <div class="flex h-screen bg-gray-100">
                        <!-- Sidebar -->
                        <div class="w-20 bg-white border-r flex flex-col">
                            <div class="p-4">
                                <div class="bg-purple-600 w-12 h-12 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-eye text-white text-xl"></i>
                                </div>
                            </div>
                            
                            <div class="flex-1 py-4">
                                <button onclick="app.state.page='admin'; app.render();"
                                        class="w-full p-3 text-gray-500 hover:bg-gray-100">
                                    <i class="fas fa-arrow-left"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Private Chats -->
                        <div class="flex-1 p-6 overflow-y-auto">
                            <div class="mb-8">
                                <h1 class="text-2xl font-bold text-gray-800 flex items-center gap-3">
                                    <i class="fas fa-eye text-purple-600"></i>
                                    –ñ–µ–∫–µ —á–∞—Ç—Ç–∞—Ä–¥—ã –∫”©—Ä“Ø“Ø
                                </h1>
                                <p class="text-gray-600 mt-2">–°–æ–∑–¥–∞—Ç–µ–ª—å–¥–∏–Ω –∞—Ç–∞–π—ã–Ω –º“Ø–º–∫“Ø–Ω—á“Ø–ª“Ø–≥“Ø</p>
                                <div class="text-sm text-gray-500 mt-1">
                                    –¢–µ–∫—à–µ—Ä“Ø“Ø “Ø—á“Ø–Ω —á–∞—Ç—Ç—ã —á—ã–∫—ã–ª–¥–∞—Ç—ã“£—ã–∑
                                </div>
                            </div>
                            
                            ${privateChats.length > 0 ? `
                                <div class="space-y-4">
                                    ${privateChats.map(chat => {
                                        const lastMessage = chat.messages[chat.messages.length - 1];
                                        return `
                                            <div class="bg-white rounded-xl border p-4 hover:shadow-md cursor-pointer"
                                                 onclick="
                                                     app.state.selectedUser1 = '${chat.userId1}';
                                                     app.state.selectedUser2 = '${chat.userId2}';
                                                     app.state.viewingPrivateChat = '${chat.userId1}_${chat.userId2}';
                                                     this.nextElementSibling.classList.toggle('hidden');
                                                 ">
                                                <div class="flex items-center justify-between">
                                                    <div class="flex items-center gap-3">
                                                        <div class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center">
                                                            <i class="fas fa-comments text-purple-600"></i>
                                                        </div>
                                                        <div>
                                                            <div class="font-medium">${chat.user1} ‚Üî ${chat.user2}</div>
                                                            <div class="text-xs text-gray-500">${chat.messages.length} –±–∏–ª–¥–∏—Ä“Ø“Ø</div>
                                                        </div>
                                                    </div>
                                                    <div class="text-xs text-gray-500">
                                                        ${lastMessage ? lastMessage.timestamp : ''}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="bg-gray-50 rounded-xl border p-4 hidden">
                                                <div class="space-y-3 max-h-60 overflow-y-auto">
                                                    ${chat.messages.map(msg => {
                                                        const sender = this.state.users.find(u => u.id === msg.senderId);
                                                        return `
                                                            <div class="${msg.senderId === chat.userId1 ? 'text-right' : 'text-left'}">
                                                                <div class="inline-block max-w-xs">
                                                                    <div class="text-xs text-gray-500 mb-1">
                                                                        ${sender?.username || '–ë–µ–ª–≥–∏—Å–∏–∑'} ‚Ä¢ ${msg.timestamp}
                                                                    </div>
                                                                    <div class="${msg.senderId === chat.userId1 ? 'bg-blue-100 text-gray-800' : 'bg-white'} rounded-lg px-3 py-2">
                                                                        ${msg.text}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        `;
                                                    }).join('')}
                                                </div>
                                                <div class="mt-4 pt-4 border-t">
                                                    <button onclick="app.tempBlockUser('${chat.userId1}', 60)"
                                                            class="px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700 mr-2">
                                                        ${chat.user1} –±–ª–æ–∫—Ç–æ–æ
                                                    </button>
                                                    <button onclick="app.tempBlockUser('${chat.userId2}', 60)"
                                                            class="px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700">
                                                        ${chat.user2} –±–ª–æ–∫—Ç–æ–æ
                                                    </button>
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            ` : `
                                <div class="text-center py-12">
                                    <i class="fas fa-comment-slash text-gray-400 text-4xl mb-4"></i>
                                    <h3 class="text-xl font-medium text-gray-800">–ñ–µ–∫–µ —á–∞—Ç—Ç–∞—Ä –∂–æ–∫</h3>
                                    <p class="text-gray-600 mt-2">–≠—á –∫–∏–º –∂–µ–∫–µ —á–∞—Ç—Ç–∞—à–∫–∞–Ω –∂–æ–∫</p>
                                </div>
                            `}
                        </div>
                    </div>
                `;
            }
        }
        
        // Initialize app
        window.app = new JalaabadChat();
    </script>
</body>
</html>
